= be_valid_asset

Provides be_valid_xhtml and (soon) be_valid_css matchers for rspec controller and view tests.

== Installation

To use rspec_hpricot_matchers in your project, install the plugin:

  ./script/plugin install git://github.com/unboxed/be_valid_asset.git

Add the following to your spec_helper.rb file:
  
  require 'be_valid_asset'

== Usage

It can be used to test either an ActionController Response object as follows:

    describe FooController do
      integrate_views

      describe "GET 'index'" do
        it "should have valid markup" do
          get 'index'
          response.should be_valid_xhtml
        end
      end
    end

or a string:

    it "should be valid xhtml" do
      html = File.read(File.join(RAILS_ROOT, %w(public index.html)))
      html.should be_valid_xhtml
    end

It is also possible to validate an xhtml fragment.  This assumes xhtml-1.0 strict.

    it "should be valid xhtml" do
      string = "<p>This is an html fragment</p>"
      string.should be_valid_xhtml_fragment
    end

== Configuration

There are a few configuration options that can be configured in spec_helper.rb as follows:

Display Full HTML for failures:
BeValidAsset::Configuration.display_invalid_content = false (default)

Change validator host/path:
BeValidAsset::Configuration.markup_validator_host = 'validator.w3.org'
BeValidAsset::Configuration.markup_validator_path = '/check'

If you are doing more than the occasional check, you should probably run your own copy of the validator, and use that.
Instructions here: http://validator.w3.org/docs/install.html

* Caching

be_valid_asset can cache the responses from the validator to save look-ups for documents that haven't changed.
To use this feature, it must be enabled, and a cache path must be set:

BeValidAsset::Configuration.enable_caching = true
BeValidAsset::Configuration.cache_path = File.join(RAILS_ROOT, %w(tmp be_valid_asset_cache))

== Future Stuff

* CSS validation

== Attribution

This was originally based on a blog post here: http://www.anodyne.ca/2007/09/28/rspec-custom-matchers-and-be_valid_xhtml/